<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Examen ‚Äì 42 preguntas</title>
  <link rel="stylesheet" href="./style.css" />
  <script>
  (function(){
    try {
      var t = localStorage.getItem('exam_theme') || 'dark';
      document.documentElement.setAttribute('data-theme', t);
    } catch(e){}
  })();
  </script>
</head>
<body>
  <noscript><div style="padding:12px;background:#ffc;color:#222">Necesitas habilitar JavaScript para usar el examen.</div></noscript>
  <div class="wrap">
    <div id="welcome" class="card pad">
      <h1>Examen Oficial (42 preguntas)</h1>
      <p class="muted">Duraci√≥n predeterminada: <strong>1 hora 30 minutos</strong>. Se muestra <strong>1 pregunta a la vez</strong>. No hay retroceso. Al terminar o agotar el tiempo, se calcula la nota autom√°ticamente.</p>
      <div class="space"></div>
      <div class="warn">
        <h3>Indicaciones</h3>
        <ul>
          <li>Lee cuidadosamente cada enunciado. Algunas preguntas pueden ser de <strong>selecci√≥n m√∫ltiple</strong>.</li>
          <li>No podr√°s volver a preguntas anteriores una vez pulses <em>Continuar</em>.</li>
          <li>El temporizador se inicia al comenzar y se detiene al <em>Finalizar examen</em> o al agotarse.</li>
          <li>El bot√≥n <em>Finalizar examen</em> cerrar√° la prueba de forma autom√°tica, por lo que no se recomienda usarlo durante el examen(solo Continuar/Finalizar).</li>
          <li>Conectarse a su correo personal gmail, <em>no el de banco</em>.</li>
          <li>Opcional: puedes <strong>activar tu c√°mara</strong> y <strong>grabar la sesi√≥n</strong> (solo en tu dispositivo) para fines de simulaci√≥n.</li>
        </ul>
      </div>
      <div class="space"></div>
      <div class="ok tiny">üí° Esta es una simulaci√≥n, guardar discreci√≥n sobre esta pagina.</div>
      <div class="space"></div>
      
      <!-- Datos del participante -->
      <label for="studentEmail" class="muted">Correo TCS (obligatorio)</label>
      <input id="studentEmail" type="email" required placeholder="usuario@tcs.com" inputmode="email" />
      <label for="studentFullName" class="muted">Nombres y Apellidos (obligatorio)</label>
      <input id="studentFullName" type="text" required placeholder="Nombres Apellidos" />
      <span class="tiny muted">El correo debe ser del dominio TCS y el nombre debe ser completo.</span>
      <div class="space"></div>
      <!-- Selector de tema (claro/oscuro) -->
      <label for="themeSelect" class="muted">Tema visual</label>
      <select id="themeSelect" style="width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#0b1220;color:#e5e7eb;margin:8px 0 12px">
        <option value="dark">Oscuro (predeterminado)</option>
        <option value="light">Claro</option>
      </select>
      <div class="space"></div>
      <!-- Conexi√≥n Gmail (autorizaci√≥n 1 sola vez) -->
      <div id="gmailConnect" class="row" style="margin:8px 0 12px">
        <button id="btnConnectGmail" class="btn">Conectar Gmail (autorizar)</button>
        <span class="tiny muted">Debe conectarse cada vez que inicie, en caso no se conecte correctamente, no se enviaria su prueba.</span>
      </div>



      <div class="row">
        <button id="btnStart" class="btn-accent">Empezar examen</button>
        <button id="btnCam" class="btn-ghost" title="Activa una vista previa en la esquina (opcional)">Activar c√°mara</button>
        <button id="btnRecord" class="btn-ghost" title="Graba tu pesta√±a + c√°mara superpuesta (opcional)">Grabar pantalla (tab)</button>
        <span class="muted tiny">La grabaci√≥n se guarda localmente; podr√°s descargarla al finalizar.</span>
      </div>
      <pre id="diag" class="diag tiny"></pre>
    </div>

    <div id="exam" class="card" style="display:none">
      <div class="pad">
        <div class="row" style="align-items:center;justify-content:space-between">
          <div>
            <h2 id="qTitle">Pregunta</h2>
            <div class="muted tiny">Pregunta <span id="qIndex">1</span> de <span id="qTotal">42</span></div>
          </div>
          <div style="min-width:260px">
            <div class="timer center pill" id="timer">02:00:00</div>
            <div class="progress" aria-hidden="true"><div id="bar" class="bar"></div></div>
          </div>
        </div>
        <div class="space"></div>
        <div id="qText" class="question"></div>
        <div class="space"></div>
        <form id="options" class="col"></form>
      </div>
      <div class="toolbar">
        <div class="left">
          <span class="pill tiny" id="modePill">√önica respuesta</span>
        </div>
        <div class="right">
          <button id="btnFinish" class="btn-danger">Finalizar examen</button>
          <button id="btnNext" class="btn-accent">Continuar ‚Üí</button>
        </div>
      </div>
    </div>

    <div id="results" class="card pad" style="display:none">
      <h2>Resultados</h2>
      <p>Tu nota: <strong class="scorebox" id="score"></strong> <span id="passStatus" class="pill"></span></p>
      <p class="muted">Se eval√∫an respuestas exactas (en selecci√≥n m√∫ltiple, debes marcar <em>todas</em> y solo las correctas).</p>
      <div class="row">
        <button class="btn-accent" id="btnDownload">Descargar grabaci√≥n</button>
        <!-- CSV desactivado por solicitud del usuario -->
        <button class="btn-accent" id="btnExportPDF">Descargar reporte (PDF)</button>
        <button class="btn-ghost" id="btnRestart">Volver a inicio</button>
      </div>
    </div>
  </div>

  <!-- jsPDF para generar el PDF del reporte -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <!-- Configuraci√≥n de Apps Script (GAS) para enviar por Gmail) -->
  <script>
    window.GAS_ENDPOINT = "https://script.google.com/macros/s/AKfycbxXgkOWYpK_vCEB7HXRchhtaNFx9lqnAhLgDj-vraGQ4fgihlPp6McDer6IeyVkXOSfKg/exec";
    window.TCS_DOMAIN = "@tcs.com";
  </script>

  <div class="corner">
    <video id="cam" class="camPreview" autoplay playsinline muted style="display:none"></video>
  </div>
  <div class="watermark">Modo examen</div>

  <script defer src="./bank.js?v=8"></script>
  <script defer src="./app.js?v=8"></script>
</body>
</html>
